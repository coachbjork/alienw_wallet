import{A as c,f as i}from"./bundle-mjs.B5z_Z45O.js";import{_ as d,a as f,g as T,d as w,u as O,f as x}from"./session.IEwVtSgz.js";import{B as D}from"./bluebird.DcYzvDGf.js";async function L(n,e){var r;const s=((r=d.find(c,a=>a.name===n))==null?void 0:r.scope)||"",t=await f(i.CONTRACT_NAME,s,i.TABLES.PROPOSALS,e);return t?{id:parseInt(t.id),proposal_name:String(t.proposal_name),proposer:String(t.proposer),packed_transaction:String(t.packed_transaction),earliest_exec_time:`${String(t.earliest_exec_time)}Z`,modified_date:`${String(t.modified_date)}Z`,state:parseInt(t.state),metadata:t.metadata}:{}}async function P(n,e){var r;const s=((r=d.find(c,a=>a.name===n))==null?void 0:r.scope)||"",t=await f(i.CONTRACT_NAME,s,i.TABLES.APPROVALS,e);return t?{proposal_name:String(t.proposal_name),requested_approvals:t.requested_approvals,provided_approvals:t.provided_approvals}:{}}async function R(n,e=void 0,s=1e3){var a;const t=((a=d.find(c,_=>_.name===n))==null?void 0:a.scope)||"",p={index_position:"3",key_type:"i64",reverse:!0,rowsPerAPIRequest:s};return e&&(p.to=e),await T(i.CONTRACT_NAME,t,i.TABLES.PROPOSALS,p)}async function z(n){var r;const e=await w(n),s=((r=d.find(c,a=>a.scope===n.params.scope))==null?void 0:r.name)||"",t=e.length>0?parseInt(e[e.length-1].modified_date.value)-1:void 0;return{rows:await D.map(e,async a=>{var S,g;const _=((S=a.metadata.find(o=>o.key==="title"))==null?void 0:S.value)||"- No title -",A=((g=a.metadata.find(o=>o.key==="description"))==null?void 0:g.value)||"- No description -",u=await O(a.packed_transaction),v=u.expiration.toDate(),m=[];for(const o of u.actions){const N=await x(o.account,o.name,o.data);m.push({contract_name:String(o.account),action_name:String(o.name),action_data:JSON.parse(JSON.stringify(N))})}const l=await P(s,a.proposal_name),y=(l==null?void 0:l.provided_approvals.map(o=>String(o.level.actor)))||[];return{proposal_id:String(a.proposal_name),proposer:String(a.proposer),earliest_exec_time:`${String(a.earliest_exec_time)}Z`,modified_date:`${String(a.modified_date)}Z`,proposal_status:parseInt(a.state),metadata:a.metadata,proposal_title:_,expiration:v,description:A,approved_by:y,actions:m}},{concurrency:3}),next_key:t,planetName:s}}export{R as a,z as b,L as g};
